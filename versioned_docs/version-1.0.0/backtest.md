---
id: backtest
title: 回测报告
sidebar_label: 回测报告
---

## 研究背景

PMM 算法代表主动做市商算法，实际上是流动性提供商使用的量化交易策略。为了让流动性提供商了解 PMM 算法的投资回报率，我们进行了一系列回测来检验 PMM 算法在不同市场环境下的表现。

## 研究方法

我们对于 PMM 算法的评估主要集中在两个方面：收益和损失。

流动性提供商的收益是周转率和手续费费率的乘积。

损失需要从两个维度进行解释，交易对手风险和套利交易。

因为 PMM 算法里的限制，我们可以忽略交易对手的风险。另外，来自普通用户的交易，这些交易基本都是随机，在统计上相对平衡。

套利交易是不可避免的。因为链上预言机的价格相比于市价总是存在延迟，所以大部分的损失由套利交易产生。

因此在下面的回测中，我们重点关注两个关键值：

- 周转率
- 套利损失

## 回测

### 收益评估

假定：

- DODO 资金池规模是 Uniswap 资金池的十分之一
- base token 和 quote token 资产相等
- PMM 参数 k=0.1
- 手续费费率为 0.3%

这些条件不是随意设定的。在这种情况下，PMM 可以提供等同于 Uniswap 的流动性，所以可以合理地假定 PMM 跟 Uniswap 交易量相等。但是因为有聚合器，所以假定 PMM 可以提供 Uniswap 一半的流动性更合理些。 根据 [历史数据](https://uniswap.info/pair/0xb4e16d0168e52d35cacd2c6185b44281ec28c9dc)得出, PMM 每日周转率是 100%, ROI 是 0.3%。

:::注意
回测报告撰写于 2020 年 7 月 19 日。回测数据使用 Uniswap 从 2020 年 6 月 1 日到 2020 年 7 月 18 日的历史数据。
:::

### 损失评估

损失的评估会相对更复杂些，因为之前没有类似 PMM 算法的项目。我们选择使用最严格的标准进行回测，假定:

- 预言机价格总存在延迟
- 预言机价格每次更新都与市价偏离 0.5%（Chainlink 上限）
- 套利者有充足的资金，不错过每笔交易
- 套利者搬砖成本为 0.2%（包括中心化交易所手续费和 gas）

我们使用 2018 年 4 月到 2020 年 4 月的 BTC 价格的历史数据，以 1 分钟为间隔进行回测。综合收益和损失，得出以下结论。

![](https://dodoex.github.io/cn/img/dodo_backtest.png)

## 结论

回测覆盖了绝大多数市场环境包括熊市、牛市，甚至包括 2020 年 3 月 12 日的黑天鹅事件。我们得出的结论是：

- 在大多数市场环境下，手续费收入可以弥补套利损失，同时带来很高的回报率（年化约 80%）
- 当市场剧烈波动时，不论涨跌，流动性提供商都会损失大量资金

一句话，PMM 算法在市场稳定时可以获利，在市场剧烈波动时会亏损。

### 优劣势

大多数量化策略只有在市场出现单边行情时才能盈利，在市场平稳时却挣不到钱。而 PMM 却相反，在价格平稳变化时可以获得可观的收益。另外与 AMM 不同，PMM 算法不要求流动性提供商按照一定比例充入 base 和 quote token。所以当市场不稳定时，PMM 可以作为原有策略的补充。

俗话说，天上不会掉馅饼。当市场波动时，流动性提供商遭受巨大损失。流动性提供商需要平衡风险和收益。我们建议交易者在市场动荡时提出资产。作为一个去中心化项目，我们能做的非常有限。我们会尽量调整系统参数来帮助流动性提供商，尤其是在黑天鹅事件发生时。

另外，回测没办法 100% 模拟出真实交易的情况。为了降低这种风险，我们用最保守的假定条件进行回测。流动性提供商还是要理智地看待回测结果。

### 回测问题解答

1. 换手率数据怎么得到的？

我们计算了 Uniswap 一个月的历史数据。因为 PMM 算法资金利用率很高达到 Uniswap 的十倍以上，所以实际换手率也会高很多。

2. 为什么使用 BTC 价格做回测研究？

我们没有找到高精度的 ETH 价格数据，非常欢迎大家能向我们提供 1 分钟间隔的 ETH 历史价格数据。使用 BTC 历史价格进行回测估算损失是合理的，因为 ETH 和 BTC 价格高度相关。

3. 套利是怎么实现的？

当套利者注意到 PMM 提供的价格跟市价相比有搬砖空间时，比如 PMM 和市价的差距大于搬砖的综合成本（PMM 手续费+搬砖成本）

4. Chainlink 的 BTC 报价精度是 1%，这里为什么设置为 0.5%？

Chainlink 很快将会把 BTC 价格的精度提升到 0.5%；另外，PMM 算法现在主要应用在 ETH 相关的交易对，而 Chainlink 的 ETH 价格精度是 0.5%。

5. 资金池的规模对于回测有影响么？

肯定有影响。如果资金池规模太小，回报率不会太高的。我们需要充足的流动性与其他的项目竞争。事实上，回测是需要用 Uniswap 十分之一的资金池规模（约 90 万美金）就可以产生有竞争力的流动性。

6. gas 消耗是怎样的？

两个 ERC20 标准的代币进行交换，需要 145000~175000 gas。gas 会比 Uniswap （约 100000）略高，但是远低于其他协议。

比如像 Kyber，需要大约 400000 gas；Balancer 需要 300000 gas；dYdX 需要 400000 gas。
